<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.0"><link rel=canonical type=text/html href=/docs/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Workshop | Unikraft Summer of Code 2021</title><meta property="og:title" content="Workshop"><meta property="og:description" content="A free and virtual Unikernel and library Operating Systems workshop held by members of the Unikraft community"><meta property="og:type" content="website"><meta property="og:url" content="/docs/"><meta property="og:site_name" content="Unikraft Summer of Code 2021"><meta itemprop=name content="Workshop"><meta itemprop=description content="A free and virtual Unikernel and library Operating Systems workshop held by members of the Unikraft community"><meta name=twitter:card content="summary"><meta name=twitter:title content="Workshop"><meta name=twitter:description content="A free and virtual Unikernel and library Operating Systems workshop held by members of the Unikraft community"><link rel=preload href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css as=style><link href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Unikraft Summer of Code 2021</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Workshop</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Workshop</h1><ul><li>1: <a href=#pg-c1e6c515a3dcbb9929303d3518abd835>Schedule</a></li><li>2: <a href=#pg-7d93865f2930080c4fafcbee4584e6f4>People</a></li><li>3: <a href=#pg-5fe3cc3ea98bbc7c5e522eb003aa1f2a>Session 01: Baby Steps</a></li><li>4: <a href=#pg-a7aba59367c86f53527a038cb13a4d73>Session 02: Behind the Scenes</a></li><li>5: <a href=#pg-7cf16a4b6aedab923e52e136ddacfa59>Session 03: Benchmarking and Debugging</a></li><li>6: <a href=#pg-cbba34b6d1e7d9a0e83c791f84d7f29d>Session 04: Complex Applications</a></li><li>7: <a href=#pg-221c0eb25b4f393f30fd7c711495bed2>Session 05: Contributing to Unikraft</a></li><li>8: <a href=#pg-c8164d0e219bb0f24fd8b32fe7e996e3>Session 06: Testing Unikraft</a></li><li>9: <a href=#pg-e8257ea2e30401a82888d38de2231d40>Session 07: Syscall Shim</a></li><li>10: <a href=#pg-0cf305157c0d79c36b53cb269a783170>Session 08: Basic App Porting</a></li><li>11: <a href=#pg-f352576afa36c9b30f15b2be6533c580>Session 09: Advanced App Porting</a></li><li>12: <a href=#pg-9026b735a1faa018402aa9ac7ce1ebd9>Session 10: High Performance</a></li></ul><div class=content><div class="alert alert-primary" role=alert><h4 class=alert-heading>Deadline for applications to the workshop has ended</h4>The application deadline was <strong>July 26, 2021, 11pm CEST</strong> and has now passed.
Fear not! We will be making all the material free as the workshop progresses so
you can follow along. All technical talks will be live streamed recorded and
all workshops will be recorded. We will post links to relevant content in due
course.</div><p><em>This website site contains information, documentation, timetables, and more for
participants of the Unikraft Summer of Code 2021 (USoC21). If you are not
participating in USoC21 feel free to use this site and its resources to learn
how to build Unikraft unikernels.</em></p><p>Unikraft Summer of Code is a <strong>free</strong> two week virtual Unikernel and library
Operating Systems workshop held by members of the Unikraft community including
professors, lecturers, PhD and MSci students from:</p><ul><li><a href=http://nets.cs.pub.ro>University POLITEHNICA of Bucharest</a>,</li><li><a href=https://net.scc.lancs.ac.uk>Lancaster University</a>,</li><li><a href=https://www.uliege.be/cms/c_8699436/en/uliege>University of Liège</a>,</li><li><a href=https://www.cs.manchester.ac.uk/research/expertise/advanced-processor-technologies/>Manchester University</a>, and</li><li>industry partners <a href=http://sysml.neclab.eu>NEC Laboratories Europe GmbH</a>.</li></ul><p>To learn more about Unikraft, please visit the <a href=https://unikraft.org>Unikraft Project
Website</a>, visit the <a href=http://docs.unikraft.org>main documentation website</a> or checkout the <a href=https://github.com/unikraft/unikraft>GitHub project</a>.</p><p>In this workshop, you will learn about how to build Unikraft unikernels,
including zero-to-hero workshops on how to get started using Unikraft. As the
week progresses, we will dive into more in-depth topics of Unikraft, including
programming structures and architectures, how it is organized, methodologies for
porting libraries and applications to Unikraft and more!</p><p>The workshop will be hands-on and will take place for 10 days, between August 23
and September 3, 2021, 4pm-8pm CEST. And an 8 hours hackathon on September 4,
2021, 9am-5pm CEST. It will be online and in English. Topics include building
unikernels, benchmarking, debugging, porting applications, virtualization and
platform specifics.</p><p><em>USoC21 and Unikraft are supported by the <a href=https://unicore-project.eu/>UNICORE Project</a>, EU Horizon 2020 grant agreement No 825377.</em></p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-c1e6c515a3dcbb9929303d3518abd835>1 - Schedule</h1><p>Unikraft Summer of Code 2021 (USoC'21) consists of 10 sessions in 10 days and a hackathon.
Each session is 4 hours long and consists of practical demos and then exercises for participants.
The hackathon is an 8 hours event where you&rsquo;ll have different tasks to enable, test, fix, evaluate and improve applications and libraries with Unikraft.</p><p>The complete schedule for USoC'21 is (all times in CEST - Central European Summer Time):</p><table><thead><tr><th>Date</th><th>Interval</th><th>Activity</th><th>TA(s)</th></tr></thead><tbody><tr><td>Mon, 23.08.2021</td><td>3:30pm-4pm<br>4pm-8pm</td><td>Opening Ceremony<br><a href=/docs/sessions/01-baby-steps/ title="01. Baby Steps">Session 01: Baby Steps</a></td><td>RazvanD, Alex, CristiV<br>Alex, CristiV, Vlad</td></tr><tr><td>Tue, 24.08.2021</td><td>4pm-8pm</td><td><a href=/docs/sessions/02-behind-scenes/ title="02. Behind the Scenes">Session 02: Behind the Scenes</a></td><td>RazvanD, Costi</td></tr><tr><td>Wed, 25.08.2021</td><td>4pm-4:30pm<br>4:30pm-8pm</td><td>Tech Talk: Debugging and Tracing in Unikraft<br><a href=/docs/sessions/03-benchmarking-and-debugging/ title="03. Benchmarking and Debugging">Session 03: Benchmarking and Debugging</a></td><td>Simon<br>CristiV, RazvanD</td></tr><tr><td>Thu, 26.08.2021</td><td>4pm-8pm</td><td><a href=/docs/sessions/04-complex-applications/ title="04. Complex Applications">Session 04: Complex Applications</a></td><td>Costi, Vlad</td></tr><tr><td>Fri, 27.08.2021</td><td>4pm-4:30pm<br>4:30pm-8pm</td><td>Tech Talk: Virtual Memory in Unikraft<br><a href=/docs/sessions/05-contributing-to-unikraft/ title="05. Contributing to Unikraft">Session 05: Contributing to Unikraft</a></td><td>Ștefan<br>Vlad, RazvanD</td></tr><tr><td>Mon, 30.08.2021</td><td>4pm-8pm</td><td><a href=/docs/sessions/06-testing-unikraft/ title="06. Testing Unikraft">Session 06: Testing Unikraft</a></td><td>CristiB, Alex</td></tr><tr><td>Tue, 31.08.2021</td><td>4pm-4:30pm<br>4:30pm-8pm</td><td>Tech Talk: Memory Deduplication with Unikraft<br><a href=/docs/sessions/07-syscall-shim/ title="07. Syscall Shim">Session 07: Syscall Shim</a></td><td>Gaulthier<br>RazvanD, Alex</td></tr><tr><td>Wed, 01.09.2021</td><td>4pm-8pm</td><td><a href=/docs/sessions/08-basic-app-porting/ title="08. Basic App Porting">Session 08: Basic App Porting</a></td><td>Cezar, RazvanD</td></tr><tr><td>Thu, 02.09.2021</td><td>4pm-4:30pm<br>4:30pm-8pm</td><td>Tech Talk: Retrofitting Isolation into Unikraft with FlexOS<br><a href=/docs/sessions/09-advanced-app-porting/ title="09. Advanced App Porting">Session 09: Advanced App Porting</a></td><td>Hugo<br>Vlad, Cezar</td></tr><tr><td>Fri, 03.09.2021</td><td>4pm-8pm</td><td><a href=/docs/sessions/10-high-performance/ title="10. High Performance">Session 10: High Performance</a></td><td>Alex, RazvanD</td></tr><tr><td>Sat, 04.09.2021</td><td>9am-5pm</td><td>Hackathon</td><td>Dragoș, Gabi, Sergiu, Florin<br>Laurențiu, Cătălin, Vlad, Alex</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-7d93865f2930080c4fafcbee4584e6f4>2 - People</h1><h3 id=program-chairs-and-project-coordinators>Program Chairs and Project Coordinators</h3><table><thead><tr><th>Name</th><th>Organization</th><th>Email</th></tr></thead><tbody><tr><td><a href=https://github.com/razvand>Răzvan Deaconescu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>razvan.deaconescu@cs.pub.ro</code></td></tr><tr><td><a href=https://github.com/nderjung>Alexander Jung</a></td><td>Lancaster University</td><td><code>a.jung@lancs.ac.uk</code></td></tr><tr><td><a href=https://github.com/skuenzer>Simon Kuenzer</a></td><td>NEC Laboratories Europe GmbH</td><td><code>simon.kuenzer@neclabs.eu</code></td></tr></tbody></table><h3 id=teaching-assistants-tas>Teaching Assistants (TAs)</h3><p>You&rsquo;ll see these kind people during the workshop to help answer questions and
work through problems.</p><table><thead><tr><th>Name</th><th>Organization</th><th>Email</th></tr></thead><tbody><tr><td><a href=https://github.com/dragosargint>Argint Dragos Iulian</a></td><td>University POLITEHNICA of Bucharest</td><td><code>dragosargint21@gmail.com</code></td></tr><tr><td><a href=https://github.com/CatalinPuscoci>Cătălin Pușcoci</a></td><td>University POLITEHNICA of Bucharest</td><td><code>catalinpuscoci@protonmail.com</code></td></tr><tr><td><a href=https://github.com/craciunoiuc>Cezar Craciunoiu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>cezar.craciunoiu@gmail.com</code></td></tr><tr><td><a href=https://github.com/consra>Constantin Raducanu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>raducanu.costi@gmail.com</code></td></tr><tr><td><a href=https://github.com/cristian-vijelie>Cristian Vijelie</a></td><td>University POLITEHNICA of Bucharest</td><td><code>cristianvijelie@gmail.com</code></td></tr><tr><td><a href=https://github.com/danield20>Daniel Dinca</a></td><td>University POLITEHNICA of Bucharest</td><td><code>dincadaniel97@gmail.com</code></td></tr><tr><td><a href=https://github.com/florin-diaconescu>Florin Diaconescu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>florin.diaconescu@protonmail.com</code></td></tr><tr><td><a href=https://github.com/laurbrb>Laurentiu Barbulescu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>lrbarbulescu@gmail.com</code></td></tr><tr><td><a href=https://github.com/CristiBM>Marius Cristian Baciu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>2309bmcristi@gmail.com</code></td></tr><tr><td><a href=https://github.com/gabrielmocanu>Mocanu Viorel Gabriel</a></td><td>University POLITEHNICA of Bucharest</td><td><code>gabi.mocanu98@gmail.com</code></td></tr><tr><td><a href=https://github.com/ungps>Paul Ungureanu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>ungureanupaulsebastian@gmail.com</code></td></tr><tr><td><a href=https://github.com/razvanvirtan>Răzvan Virtan</a></td><td>University POLITEHNICA of Bucharest</td><td><code>virtanrazvan@gmail.com</code></td></tr><tr><td><a href=https://github.com/mogasergiu>Sergiu Moga</a></td><td>University POLITEHNICA of Bucharest</td><td><code>sergiu.moga@protonmail.com</code></td></tr><tr><td><a href=https://github.com/vladandrew>Vlad-Andrei Badoiu</a></td><td>University POLITEHNICA of Bucharest</td><td><code>vlad_andrei.badoiu@upb.ro</code></td></tr></tbody></table><div class="alert alert-primary" role=alert><h4 class=alert-heading>Contact</h4>The fastest way to get in contact with anyone in this workshop regarding the
workshop is to join the <a href=https://bit.ly/UnikraftDiscord>Unikraft Community Discord</a>.</div></div><div class=td-content style=page-break-before:always><h1 id=pg-5fe3cc3ea98bbc7c5e522eb003aa1f2a>3 - Session 01: Baby Steps</h1><p>In this session we are going to understand the basic layout of the Unikraft working directory, its environment variables, as well as what the most common Unikraft specific files mean.
We are also going to take a look at how we can build basic applications and how we can extend their functionality and support by adding ported external libraries.</p><p>Before everything, let&rsquo;s take a bird&rsquo;s eye view of what Unikraft is and what we can do with it.
Unikraft is a unikernel SDK, meaning it offers you the blocks (source code, configuration and build system, runtime support) to build and run unikernels.
A unikernel is a single image file that can be loaded and run as a separate running instance, most often a virtual machine.</p><p>Summarily, Unikraft components are shown in the image below:</p><p><img src=/docs/sessions/01-baby-steps/images/unikraft_components.png alt="arch selection menu"></p><p>Unikraft is the core component, consisting of core / internal libraries, the build system, and platform and architecture code.
It is the basis of any unikernel image.
It is located in the <a href=https://github.com/unikraft/unikraft>main Unikraft repository</a>.</p><p>Libraries are additional software components that will be linked with Unikraft for the final image.
There are multiple supported libraries.
Each unikernel image is using its specific libraries.
Libraries are also called <strong>external</strong> libraries as they sit outside the main Unikraft repository.
Libraries are typically common libraries (such as OpenSSL or LWIP) that have been ported on top of Unikraft.
They are located in specialized repositories in the <a href=https://github.com/unikraft/>Unikraft organization</a>, those whose names start with <code>lib-</code>.</p><p>Application is the actual application code.
It typically provides the <code>main()</code> function (or equivalent) and is reliant on Unikraft and external libraries.
Applications that have been ported on top of Unikraft are located in repositories in the <a href=https://github.com/unikraft/>Unikraft organization</a>, those whose names start with <code>app-</code>.</p><p>An important role of the core Unikraft component is providing support for different platforms and architectures.
A platform is the virtualization / runtime environment used to run the resulting unikernel image.
An architecture details the CPU and memory specifics that will run the resulting image.</p><p>As this is a rather complicated setup, a companion tool (<a href=https://github.com/unikraft/kraft>kraft</a>) was designed and implemented to provide the interface for configuring, building and running unikernel images based on Unikraft.
The recommended way of building and running Unikraft is via <code>kraft</code>.</p><p>We are going to build the <a href=https://github.com/unikraft/app-helloworld>helloworld</a> application and the <a href=https://github.com/unikraft/app-httpreply>httpreply</a> application using <code>kraft</code>.
We are also going to use the lower-level configuration and build system (based on <a href=https://www.kernel.org/doc/html/latest/kbuild/kconfig-language.html>Kconfig</a> and Makefile) to get a grasp of how everything works.
The lower-level system will be detailed further in session 02: Behind the Scenes.</p><h2 id=demos>Demos</h2><h3 id=00-manual-kraft-installation>00. Manual kraft Installation</h3><p>Let&rsquo;s start with installing kraft (and validating the installation).</p><p>First of all, make sure you have all the dependencies installed:</p><pre><code>$ sudo apt-get install -y --no-install-recommends build-essential \
        libncurses-dev libyaml-dev flex git wget socat bison \
        unzip uuid-runtime
</code></pre><p>We begin by cloning the kraft repository on our machine:</p><pre><code>git clone https://github.com/unikraft/kraft.git
</code></pre><p>Now, all we have to do is enter this directory and run the setup installer:</p><pre><code>$ cd kraft
$ pip install --user -e .
</code></pre><p>This will install kraft for the local user.</p><p>After installing or updating kraft, the first step is to download / update the software components available for building unikernel images.
For this, run:</p><pre><code>$ kraft list update
</code></pre><p>It&rsquo;s very likely that running the command above will result in the following error:</p><pre><code>GitHub rate limit exceeded.  You can tell kraft to use a personal access token by setting the UK_KRAFT_GITHUB_TOKEN environmental variable.
</code></pre><p>If this is the case, first create a GitHub personal access token by following <a href=https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token>these instructions</a>.
Then, use the following command:</p><pre><code>$ UK_KRAFT_GITHUB_TOKEN=&lt;your_GitHub_token_here&gt; kraft list update
</code></pre><p>After this is done, you can get a list of all components that are available for use with kraft:</p><pre><code>$ kraft list
UNIKRAFT        	VERSION 	RELEASED    	LAST CHECKED
unikraft        	0.5     	17 hours ago	18 Aug 21

PLATFORMS       	VERSION 	RELEASED    	LAST CHECKED
solo5           	0.5     	13 Jul 21   	18 Aug 21
[...]

LIBRARIES       	VERSION 	RELEASED    	LAST CHECKED
newlib          	0.5     	5 days ago  	18 Aug 21
pthreadpool     	0.5     	7 days ago  	18 Aug 21
lwip            	0.5     	6 days ago  	18 Aug 21
[...]

APPLICATIONS    	VERSION 	RELEASED    	LAST CHECKED
python3         	0.4     	29 Mar 21   	18 Aug 21
helloworld      	0.5     	29 Mar 21   	18 Aug 21
httpreply       	0.5     	13 Jul 21   	18 Aug 21
[...]
</code></pre><p>So, with kraft we have an interface to configure, build and run unikernel images based on Unikraft core, (external) platforms, (external) libraries and applications.</p><p>By default, these are saved to <code>~/.unikraft/</code> directory, which is also the value of the <code>UK_WORKDIR</code> environment variable used by kraft.
This represents the working directory for all Unikraft components.
This is the usual layout of the <code>~/.unikraft/</code> directory:</p><pre><code>|-- apps - This is where you would normally place existing app build
|-- archs - Here we place our custom arch's files
|-- libs - This is where the build system looks for external library pool sources
|-- plats - The files for our custom plats are placed here
`-- unikraft - The core source code of the Unikraft Unikernel
</code></pre><p>Apart from the general <code>UK_WORKDIR</code> environment variable that points to the overall directory, there are also environment variables available for the above subdirectories:</p><pre><code>UK_ROOT - The directory for Unikraft's core source code [default: $UK_WORKDIR/unikraft]
UK_LIBS - The directory of all the external Unikraft libraries [default: $UK_WORKDIR/libs]
UK_APPS - The directory of all the template applications [default: $UK_WORKDIR/apps]
</code></pre><p>After successfully running the above commands, kraft is now installed on our system and we can get to building and running unikernels.</p><h3 id=01-building-and-running-the-helloworld-application>01. Building and Running the Helloworld Application</h3><p>This is where the fun part begins - we get to build our first unikernel.</p><h4 id=one-command-to-rule-them-all>One Command to Rule Them All</h4><p>kraft makes it easy to download, configure, build existing components into unikernel images and then run those images.
The <code>kraft up</code> command makes it easy to do that with one swoop.
Let&rsquo;s do that for the <code>helloworld</code> application (listed with <code>kraft list</code>):</p><pre><code>$ kraft up -t helloworld hello
 100.00% :::::::::::::::::::::::::::::::::::::::: |       21 /       21 |:  app/helloworld@0.5
[INFO    ] Initialized new unikraft application: /home/razvan/hello
make: Entering directory '/home/razvan/.unikraft/unikraft'
[...]
#
# configuration written to /home/razvan/hello/.config
#
[...]
CC      libkvmplat: trace.common.o
CC      libkvmplat: traps.isr.o
CC      libkvmplat: cpu_features.common.o
[...]
CC      libnolibc: errno.o
CC      libnolibc: stdio.o
CC      libnolibc: ctype.o
[...]
LD      hello_kvm-x86_64.ld.o
OBJCOPY hello_kvm-x86_64.o
LD      hello_kvm-x86_64.dbg
SCSTRIP hello_kvm-x86_64
GZ      hello_kvm-x86_64.gz
LN      hello_kvm-x86_64.dbg.gdb.py
[...]
Successfully built unikernels:

  =&gt; build/hello_kvm-x86_64
  =&gt; build/hello_kvm-x86_64.dbg (with symbols)

[...]
To instantiate, use: kraft run
[...]
Starting VM...
[...]
                   Tethys 0.5.0~b8be82b
Hello world!
Arguments:  &quot;/home/razvan/hello/build/hello_kvm-x86_64&quot; &quot;console=ttyS0&quot;
</code></pre><p>In the snippet above, we selected parts of the output showing what <code>kraft</code> does behind the scenes:</p><ol><li>It downloads the <code>helloworld</code> application repository in the <code>hello/</code> directory.</li><li>It configures the repository, resulting in a <code>.config</code> file.</li><li>It builds the required components, resulting in the <code>build/hello_kvm-x86_64</code> unikernel image.</li><li>It runs the image, resulting in QEMU/KVM being run, with the &ldquo;Hello world!&rdquo; message getting printed.</li></ol><p>All that magic is done using one command.</p><p>A closer inspection of the <code>hello/</code> folder reveals it is a clone of the <a href=https://github.com/unikraft/app-helloworld>app-helloworld repository</a> and it stores the resulting configuration file (<code>.config</code>) and resulting build folder (and images) (<code>build/</code>):</p><pre><code>$ ls -Fa hello/
./  ../  build/  CODING_STYLE.md  .config  Config.uk  CONTRIBUTING.md  COPYING.md  .git/  kraft.yaml  main.c  MAINTAINERS.md  Makefile  Makefile.uk  monkey.h  README.md
</code></pre><p>Once this is done, we can now run the resulting unikernel image any time we want by simply using <code>kraft run</code>:</p><pre><code>$ cd hello/
$ kraft run
[...]
                   Tethys 0.5.0~b8be82b
Hello world!
Arguments:  &quot;/home/razvan/hello/build/hello_kvm-x86_64&quot; &quot;console=ttyS0&quot;
</code></pre><h4 id=doing-it-step-by-step-using-kraft>Doing it Step-by-Step Using kraft</h4><p>The above <code>kraft up</code> command seems like magic and it&rsquo;s not very clear what&rsquo;s really happening.
Let&rsquo;s break that down into subcommands and really get a good grip of the configure, build and run process.</p><p>We will go through the same steps above, running a separate command for each step:</p><ol><li>Download / Initialize the helloworld appplication.</li><li>Configure the application, resulting in a <code>.config</code> file.</li><li>Build the required components, resulting in the <code>build/hello_kvm-x86_64</code> unikernel image.</li><li>Run the image, with the &ldquo;Hello world!&rdquo; message getting printed.</li></ol><h5 id=initialize>Initialize</h5><p>First, let&rsquo;s create a directory that will host the application.
We enter the <code>demo/</code> directory of the current session and we create the <code>01-hello-world/</code> directory:</p><pre><code>$ cd demo/
$ mkdir 01-hello-world
$ cd 01-hello-world/
</code></pre><p>Now, we initialize the application by using the template for the helloworld app and see that it&rsquo;s populated with files belonging to the app:</p><pre><code>$ kraft init -t helloworld
$ ls
CODING_STYLE.md  Config.uk  CONTRIBUTING.md  COPYING.md  kraft.yaml  main.c  MAINTAINERS.md  Makefile  Makefile.uk  monkey.h  README.md
</code></pre><p>The <code>kraft.yaml</code> file is the most important file.
It stores kraft-speficic configuration for the app and it&rsquo;s used by kraft when configuring, building and running the application.
Other files are important as well, but they are used behind the scenes by kraft.
We will detail them later in the session and in session 02: Behind the Scenes.</p><h5 id=configure>Configure</h5><p>A unikernel image may be targeted for multiple platforms and architectures.
The available platforms and applications are listed in the <code>kraft.yaml</code> file:</p><pre><code>$ cat kraft.yaml
specification: '0.4'

unikraft: '0.5'

architectures:
  x86_64: true
  arm64: true

platforms:
  linuxu: true
  kvm: true
  xen: true
</code></pre><p>In our case, we can target the <code>x86_64</code> or <code>arm64</code> architectures.
And we can target <code>linuxu</code>, <code>kvm</code> or <code>xen</code> platforms.</p><p>The simplest way to select the platform and architecture is by running <code>kraft configure</code> and then interactively use arrow keys to select the desired option:</p><pre><code>$ kraft configure
[?] Which target would you like to configure?: 01-hello-world_linuxu-x86_64
 &gt; 01-hello-world_linuxu-x86_64
   01-hello-world_kvm-x86_64
   01-hello-world_xen-x86_64
   01-hello-world_linuxu-arm64
   01-hello-world_kvm-arm64
   01-hello-world_xen-arm64
</code></pre><p>We have 6 options (2 architectures x 3 platforms).
Once we select one, the configuration will be updated.</p><p>The alternate way (non-interactive) is to pass arguments to <code>kraft configure</code> to select the desired platform and architecture.
For example, if we want to use x86_64 and KVM, we use:</p><pre><code>$ kraft configure -p kvm -m x86_64
</code></pre><h5 id=build>Build</h5><p>Everything is set up now, all we have left to do is tell the build system to do its magic:</p><pre><code>$ kraft build
[...]
Successfully built unikernels:

  =&gt; build/01-hello-world_kvm-x86_64
  =&gt; build/01-hello-world_kvm-x86_64.dbg (with symbols)

To instantiate, use: kraft run
</code></pre><p>This results in the creation of two unikernel image files:</p><ol><li><code>build/01-hello-world_kvm-x86_64</code> - the main image file</li><li><code>build/01-hello-world_kvm-x86_64.dbg</code> - the image file with debug information (useful for debugging, duh!)</li></ol><p>And that&rsquo;s it! Our final unikernel binary is ready to be launched from the <code>build/</code> directory.</p><h5 id=run>Run</h5><p>To run an already-built unikernel image, we use <code>kraft run</code>:</p><pre><code>$ kraft run
[...]

                   Tethys 0.5.0~b8be82b
Hello world!
[...]
</code></pre><p>If we want to be more specific, we could use:</p><pre><code>$ kraft run -p kvm -m x86_64
</code></pre><p>This command is useful in the case we have multiple images built (for differing platforms and architectures).
We can then select which one to run.</p><p>For example, we can use the commands below to configure, build and run a helloworld image for the <code>linuxu</code> platform.</p><pre><code>kraft configure -p linuxu -m x86_64
kraft build
kraft run -p linuxu -m x86_64
</code></pre><p>You can now alter between running the <code>linuxu</code> and the <code>kvm</code> built images by using <code>kraft run</code> with the appropriate arguments.</p><h4 id=more-on-kraft>More on kraft</h4><p>Of course, this is the most basic way you can use <code>kraft</code>, but there are many other options.
To see every option <code>kraft</code> has to offer, you can simply type <code>kraft -h</code>.
If you want to know about a certain command, just follow it with the <code>-h</code> option.
For example, if I wanted to know more about the configure command, I would type <code>kraft configure -h</code>.</p><h4 id=manually-building-the-helloworld-application>Manually Building the helloworld Application</h4><p>Let&rsquo;s now learn how to build the app manually, without <code>kraft</code>.
We won&rsquo;t go into too much detail, this will be handled more thoroughly in session 02: Behind the Scenes.</p><p>The manual approach is more complicated (albeit giving you potentially more control) than kraft.
For most of the use cases (development, testing, evaluating, using) of Unikraft, we recommend you use kraft.</p><p>We will go through the same steps as above:</p><ol><li>Download / Initialize the helloworld application.</li><li>Configure the application, resulting in a <code>.config</code> file.</li><li>Build the required components, resulting in the <code>build/hello_kvm-x86_64</code> unikernel image.</li><li>Run the image, with the &ldquo;Hello world!&rdquo; message getting printed.</li></ol><h5 id=initialize-1>Initialize</h5><p>First, get out of the current build&rsquo;s directory and make a new one:</p><pre><code>$ cd ../ &amp;&amp; mkdir 01-hello-world-manual &amp;&amp; cd 01-hello-world-manual
</code></pre><p>Now, clone the remote Git repository:</p><pre><code>$ git clone https://github.com/unikraft/app-helloworld.git .
$ ls
CODING_STYLE.md  Config.uk  CONTRIBUTING.md  COPYING.md  kraft.yaml  main.c  MAINTAINERS.md  Makefile  Makefile.uk  monkey.h  README.md
</code></pre><h5 id=configure-1>Configure</h5><p>To configure the build process (and the resulting unikernel image) we access a text-user interface menu by using:</p><pre><code>$ make menuconfig
</code></pre><p>Looks like we are met with an error:</p><pre><code>$ make menuconfig
Makefile:9: recipe for target 'menuconfig' failed
make: *** [menuconfig] Error 2
</code></pre><p>We look in the <code>Makefile</code>:</p><pre><code>$ cat -n Makefile
     1  UK_ROOT ?= $(PWD)/../../unikraft
     2  UK_LIBS ?= $(PWD)/../../libs
     3  LIBS :=
     4
     5  all:
     6          @$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS)
     7
     8  $(MAKECMDGOALS):
     9          @$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS) $(MAKECMDGOALS)
</code></pre><p>The underlying build / configuration system expects the Unikernel (<code>UK_ROOT</code>) to be located at <code>../../unikraft</code> from the current directory, which is very likely not the case.
Recall that the build system makes use of some important environment variables, namely <code>UK_WORKDIR</code>, <code>UK_ROOT</code> and <code>UK_LIBS</code>.
So, in order to properly inform the build system of our current location, we will have to manually set these by prefixing whatever build command we send with the hardcoded values of where our <code>Unikraft</code> work directory is.</p><pre><code>$ UK_WORKDIR=~/.unikraft UK_ROOT=~/.unikraft/unikraft UK_LIBS=~/.unikraft/libs make menuconfig
</code></pre><p><strong>Note</strong>: This menu is also available through the <code>kraft menuconfig</code> command, which rids you of the hassle of manually setting the environment variables.</p><p>We are met with the following configuration menu. Let&rsquo;s pick the architecture:</p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_arch.png alt="arch selection menu"></p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_arch2.png alt="arch selection menu2"></p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_arch3.png alt="arch selection menu3"></p><p>Now, press <code>Exit</code> (or hit the <code>Esc</code> key twice) until you return to the initial menu.</p><p>We have now set our desired architecture, let&rsquo;s now proceed with the platform.
We will choose both <code>linuxu</code> and <code>kvm</code>:</p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_plat.png alt="plat selection menu"></p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_plat2.png alt="plat selection menu2"></p><p><code>Save</code> and exit the configuration menu by repeatedly selecting <code>Exit</code>.</p><h5 id=build-1>Build</h5><p>Now let&rsquo;s build the final image (recall the environment variables):</p><pre><code>$ UK_WORKDIR=~/.unikraft UK_ROOT=~/.unikraft/unikraft UK_LIBS=~/.unikraft/libs  make
[...]
  LD      01-hello-world-manual_linuxu-x86_64.dbg
  SCSTRIP 01-hello-world-manual_kvm-x86_64
  GZ      01-hello-world-manual_kvm-x86_64.gz
  SCSTRIP 01-hello-world-manual_linuxu-x86_64
  LN      01-hello-world-manual_kvm-x86_64.dbg.gdb.py
  LN      01-hello-world-manual_linuxu-x86_64.dbg.gdb.py
</code></pre><p>Our final binaries are located inside the <code>build/</code> directory.</p><h5 id=run-1>Run</h5><p>Let&rsquo;s run the <code>linuxu</code> image by doing a Linux-like executable running:</p><pre><code>$ ./build/01-hello-world-manual_linuxu-x86_64  # The linuxu image
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~b8be82b
Hello world!
</code></pre><p>To run the KVM image, we use the <code>qemu-system-x86_64</code> command:</p><pre><code>$ qemu-system-x86_64 -kernel build/01-hello-world-manual_kvm-x86_64 -nographic
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~b8be82b
Hello world!
Arguments:  &quot;build/hello_kvm-x86_64&quot;
</code></pre><h3 id=02-building-and-running-the-httpreply-application>02. Building and Running the httpreply Application</h3><p>This is where we will take a look at how to build a basic HTTP Server both through <code>kraft</code> and manually.
The latter involves understanding how to integrate ported external libraries, such as <code>lwip</code>.</p><h4 id=using-kraft>Using kraft</h4><p>Just as before, let&rsquo;s create a directory that will host the application.
We enter the <code>demo/</code> directory of the current session and we create the <code>01-hello-world/</code> directory:</p><pre><code>$ cd demo/
$ mkdir 02-httpreply
$ cd 02-httpreply/
</code></pre><p>Now, we go through the steps above.</p><h5 id=initialize-2>Initialize</h5><p>Retrieve the already existing template for <code>httpreply</code>:</p><pre><code>$ kraft init -t httpreply
</code></pre><h5 id=configure-2>Configure</h5><p>Configure the building of a KVM unikernel image for x86_64:</p><pre><code>$ kraft configure -p kvm -m x86_64
</code></pre><h5 id=build-2>Build</h5><pre><code>$ kraft build
</code></pre><h5 id=run-2>Run</h5><pre><code>$ kraft run -p kvm -m x86_64
[...]
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~b8be82b
Listening on port 8123...
</code></pre><p>Use <code>Ctrl+c</code> to stop the HTTP server running as a unikernel virtual machine.</p><h5 id=connecting-to-the-http-server>Connecting to the HTTP Server</h5><p>The server listens on port <code>8123</code> but we can&rsquo;t access it, as the virtual machine doesn&rsquo;t have a (virtual) network connection to the host system and it doesn&rsquo;t have an IP address.
So we have to create a connection and assign an IP address.</p><p>We use a virtual bridge to create a connection between the VM and the host system.
We assign address <code>172.44.0.1/24</code> to the bridge interface (pointing to the host) and we assign address <code>172.44.0.2/24</code> to the virtual machine, by passing boot arguments.</p><p>We run the commands below to create and assign the IP address to the bridge <code>virbr0</code>:</p><pre><code>$ sudo brctl addbr virbr0
$ sudo ip a a  172.44.0.1/24 dev virbr0
$ sudo ip l set dev virbr0 up
</code></pre><p>We can check the proper configuration:</p><pre><code>$ ip a s virbr0
420: virbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000
    link/ether 3a:3e:88:e6:a1:e4 brd ff:ff:ff:ff:ff:ff
    inet 172.44.0.1/24 scope global virbr0
       valid_lft forever preferred_lft forever
    inet6 fe80::383e:88ff:fee6:a1e4/64 scope link
       valid_lft forever preferred_lft forever
</code></pre><p>Now we start the virtual machine and pass it the proper arguments to assign the IP address <code>172.44.0.2/24</code>:</p><pre><code>$ kraft run -b virbr0 &quot;netdev.ipv4_addr=172.44.0.2 netdev.ipv4_gw_addr=172.44.0.1 netdev.ipv4_subnet_mask=255.255.255.0 --&quot;
[...]
0: Set IPv4 address 172.44.0.2 mask 255.255.255.0 gw 172.44.0.1
en0: Added
en0: Interface is up
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~b8be82b
Listening on port 8123...
</code></pre><p>The boot message confirms the assigning of the <code>172.44.0.2/24</code> IP address to the virtual machine.
It&rsquo;s listening on port 8123 for HTTP connections on that IP address.
We use <code>wget</code> to validate it&rsquo;s working properly and we are able to get the <code>index.html</code> file:</p><pre><code>$ wget 172.44.0.2:8123
--2021-08-18 16:47:38--  http://172.44.0.2:8123/
Connecting to 172.44.0.2:8123... connected.
HTTP request sent, awaiting response... 200 OK
[...]
2021-08-18 16:47:38 (41.5 MB/s) - ‘index.html’ saved [160]
</code></pre><p>Cleaning up means closing the virtual machine (and the HTTP server) and disabling and deleting the bridge interface:</p><pre><code>$ sudo ip l set dev virbr0 down
$ sudo brctl delbr virbr0
</code></pre><h4 id=the-manual-way>The Manual Way</h4><h5 id=initialize-3>Initialize</h5><p>First, move into a new directory and clone the <code>httpreply</code> repo there.</p><pre><code>$ cd .. &amp;&amp; mkdir 02-httpreply-manual &amp;&amp; cd 02-httpreply-manual
$ git clone https://github.com/unikraft/app-httpreply .
</code></pre><h5 id=adding-a-makefile>Adding a Makefile</h5><p>Unlike before, you can notice that this time we are missing the regular <code>Makefile</code>.
Let&rsquo;s start by copying the <code>Makefile</code> from helloworld:</p><pre><code>$ cp ../01-hello-world/Makefile .
</code></pre><p>This is how it looks like:</p><pre><code>$ cat Makefile
UK_ROOT ?= $(PWD)/../../unikraft
UK_LIBS ?= $(PWD)/../../libs
LIBS :=

all:
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS)

$(MAKECMDGOALS):
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS) $(MAKECMDGOALS)
</code></pre><p>As you can see, the previously presented environment values make the same wrong assumption.
Previously, we fixed this by preceding the <code>make</code> command with the updated values for the environment variables, but we could have also simply modified them from within the <code>Makefile</code>, like so:</p><pre><code>UK_ROOT ?= $(HOME)/.unikraft/unikraft
UK_LIBS ?= $(HOME)/.unikraft/libs
LIBS :=


	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS)

$(MAKECMDGOALS):
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS) $(MAKECMDGOALS)
</code></pre><p>For the HTTP server, however, we need the <code>lwip</code> library, and we have to add it to the <code>LIBS</code> variable in the Makefile.
We add it by first downloading it on our system in <code>$(UK_WORKDIR)/libs/</code>:</p><pre><code>$ git clone https://github.com/unikraft/lib-lwip ~/.unikraft/libs/lwip
fatal: destination path '~/.unikraft/libs/lwip' already exists and is not an empty directory.
</code></pre><p>The library is already cloned. That is because <code>kraft</code> took care of it for us behind the scenes in our previous automatic build.</p><p>The next step is to add this library in the <code>Makefile</code>:</p><pre><code>UK_ROOT ?= $(HOME)/.unikraft/unikraft
UK_LIBS ?= $(HOME)/.unikraft/libs
LIBS := $(UK_LIBS)/lwip

all:
        @$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS)

$(MAKECMDGOALS):
        @$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS) $(MAKECMDGOALS)
</code></pre><h5 id=configure-3>Configure</h5><p>Now, we configure it through <code>make menuconfig</code>.</p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_lwip.png alt="lwip selection menu"></p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_lwip2.png alt="lwip2 selection menu"></p><p>If you noticed, the menu also automatically selected some other internal components that would be required by <code>lwip</code>.
Now <code>Save</code> and <code>Exit</code> the configuration and run <code>make</code>.</p><h5 id=build-3>Build</h5><pre><code>$ make
</code></pre><h5 id=run-3>Run</h5><p>To run the KVM image, we use the <code>qemu-system-x86_64</code> command:</p><pre><code>$ qemu-system-x86_64 -kernel build/02-httpreply-manual_kvm-x86_64 -nographic
[...]
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~b8be82b
Listening on port 8123...
</code></pre><p>To close the running QEMU process, use the <code>Ctrl+a x</code> key combination.</p><p><strong>Note</strong>: We didn&rsquo;t go into configuring a functional network connection and actually querying the HTTP server.
This is a bit more complicated and is outside the scope of this session.</p><pre><code>sudo qemu-system-x86_64 -netdev bridge,id=en0,br=virbr0 -device virtio-net-pci,netdev=en0 -append &quot;netdev.ipv4_addr=172.44.0.2 netdev.ipv4_gw_addr=172.44.0.1 netdev.ipv4_subnet_mask=255.255.255.0 --&quot; -kernel build/02-httpreply-manual_kvm-x86_64 -nographic
</code></pre><h5 id=connecting-to-the-http-server-1>Connecting to the HTTP Server</h5><p>Similarly to kraft, in order to connect to the HTTP server, we use a virtual bridge to create a connection between the VM and the host system.
We assign address <code>172.44.0.1/24</code> to the bridge interface (pointing to the host) and we assign address <code>172.44.0.2/24</code> to the virtual machine, by passing boot arguments.</p><p>We run the commands below to create and assign the IP address to the bridge <code>virbr0</code>:</p><pre><code>$ sudo brctl addbr virbr0
$ sudo ip a a  172.44.0.1/24 dev virbr0
$ sudo ip l set dev virbr0 up
</code></pre><p>Now we start the virtul machine and pass it the proper arguments to assing the IP address <code>172.44.0.2/24</code>:</p><pre><code>$ sudo qemu-system-x86_64 -netdev bridge,id=en0,br=virbr0 -device virtio-net-pci,netdev=en0 -append &quot;netdev.ipv4_addr=172.44.0.2 netdev.ipv4_gw_addr=172.44.0.1 netdev.ipv4_subnet_mask=255.255.255.0 --&quot; -kernel build/02-httpreply-manual_kvm-x86_64 -nographic
0: Set IPv4 address 172.44.0.2 mask 255.255.255.0 gw 172.44.0.1
en0: Added
en0: Interface is up
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~b8be82b
Listening on port 8123...
[...]
</code></pre><p>The boot message confirms the assigning of the <code>172.44.0.2/24</code> IP address to the virtual machine.
It&rsquo;s listening on port 8123 for HTTP connections on that IP address.
We use <code>wget</code> to validate it&rsquo;s working properly and we are able to get the <code>index.html</code> file:</p><pre><code>$ wget 172.44.0.2:8123
--2021-08-18 16:47:38--  http://172.44.0.2:8123/
Connecting to 172.44.0.2:8123... connected.
HTTP request sent, awaiting response... 200 OK
[...]
2021-08-18 16:47:38 (41.5 MB/s) - ‘index.html’ saved [160]
</code></pre><p>Cleaning up means closing the virtual machine (and the HTTP server) and disabling and deleting the bridge interface:</p><pre><code>$ sudo ip l set dev virbr0 down
$ sudo brctl delbr virbr0
</code></pre><h2 id=summary>Summary</h2><p><code>kraft</code>is an extremely useful tool for quickly deploying unikernel images.
It abstracts away many factors that would normally increase the difficulty of such tasks.
Through just a simple set of a few commands, we can build and run a set of fast and secure unikernel images with low memory footprint.</p><h2 id=practical-work>Practical Work</h2><h3 id=01-echo-back-server>01. Echo-back Server</h3><p>You will have to implement a simple echo-back server in C for the KVM platform.
The application will have to be able to open a socket on <code>172.44.0.2:1234</code> and send back to the client whatever the client sends to the server.
If the client closes the connection, the server will automatically close.</p><p>Enter the <code>work/01-echo-back/</code> directory.
Check the source code file (<code>main.c</code>) and support files.
Work on the contents to have a viable echo-back server implementation.
Things to consider:</p><ul><li>You will need some network client utility such as <code>netcat</code>.</li><li>You will need the Lightweight TCP/IP stack library (lwip): <a href=https://github.com/unikraft/lib-lwip>https://github.com/unikraft/lib-lwip</a></li><li>You will have to update the build and support files in the <code>work/01-echo-back/</code> directory.</li><li>If you want to run the application without <code>kraft</code>, the KVM launch script and network setup are already included inside <code>work/01-echo-back/launch.sh</code>.</li></ul><p>To test if your application works you can try sending it messages like so:</p><pre><code>$ nc 172.44.0.2 1234
</code></pre><p>After connecting to the server, whatever you enter in standard input, should be echoed back to you.</p><h3 id=02-rot-13>02. ROT-13</h3><p>Update the previously built application, to echo back a <code>rot-13</code> encoded message.
To do this, you will have to create a custom function inside <code>lwip</code> (<code>~/.unikraft/libs/lwip/</code>) that your application (from the new directory <code>work/02-rot13</code>) can call in order to encode the string.
For example, you could implement the function <code>void rot13(char *msg);</code> inside <code>~/.unikraft/libs/lwip/sockets.c</code> and add its header inside <code>~/.unikraft/libs/lwip/include/sys/socket.h</code>.</p><p>The required resources are the exact same as in the previous exercise, you will just have to update <code>lwip</code>.
To test if this works, use the same methodology as before, but ensure that the echoed back string is encoded.</p><h3 id=03-tutorial-mount-9pfs>03. Tutorial: Mount 9pfs</h3><p>In this tutorial, we will see what we would need to do if we wanted to have a filesystem available.
To make it easy, we will use the <code>9pfs</code> filesystem, as well as the <code>newlib</code> library.
The latter is used so that we have available an API that would enable us to interact with this filesystem (functions such as <code>lseek</code>, <code>open</code>).</p><p><strong>Note</strong>: the build will fail if <code>unikraft</code> and <code>newlib</code> repositories aren&rsquo;t both on the <code>staging</code> or the <code>stable</code> branches.
To avoid this situation, go to <code>~/.unikraft/unikraft</code> and checkout branch <code>staging</code>:</p><pre><code>cd ~/.unikraft/unikraft
git checkout staging
</code></pre><p>We will need to download <code>newlib</code>:</p><pre><code>git clone https://github.com/unikraft/lib-newlib.git ~/.unikraft/libs/newlib
</code></pre><p>Next, we include it in our <code>Makefile</code>:</p><pre><code>LIBS := $(UK_LIBS)/lwip:$(UK_LIBS)/newlib
</code></pre><p>And now, for the final step, through <code>make menuconfig</code> make sure you have selected <code>libnewlib</code> as well as <code>9pfs: 9p filesystem</code> inside the <code>Library Configuration</code> menu.
We will also check these options inside <code>Library Configuration</code> -> <code>vfscore: Configuration</code>:</p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_fs.png alt="fs selection menu"></p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_fs2.png alt="fs2 selection menu"></p><p><img src=/docs/sessions/01-baby-steps/images/menuconfig_select_fs3.png alt="fs3 selection menu"></p><p>What is more, you should also have present in the current directory an additional directory called <code>fs0</code>:</p><pre><code>mkdir fs0
</code></pre><p>And so, <code>fs0</code> will contain whatever files you create, read from or write to from within your unikernel.</p><p>For now, just make sure it successfully builds. If it does, move on to the next work item.</p><h3 id=04-store-strings>04. Store Strings</h3><p>For the final work item, you will have to update the source code from the second task, so that it stores in a file the received string before sending the encoded one back to the client.
In order to achieve this, you must have the previous work item completed.</p><p>The available resources are the exact same, you will simply have to modify <code>main.c</code>.</p><p>To test if your application ran successfully, check to see whether the original strings you sent through the client are present in that file or not.</p><h2 id=further-reading>Further Reading</h2><p><a href=http://docs.unikraft.org/index.html>Unikraft Documentation</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-a7aba59367c86f53527a038cb13a4d73>4 - Session 02: Behind the Scenes</h1><h2 id=reminders>Reminders</h2><h3 id=kraft>Kraft</h3><p><a href=https://github.com/unikraft/kraft>Kraft</a> is the tool developed by the Unikraft team, to make application deployment easier.
To automatically download, configure, build and run an application, for example Helloworld, run</p><pre><code>$ kraft list update
$ kraft up -t helloworld@staging ./my-first-unikernel
</code></pre><p>If you are already working with cloned / forked repositories from Unikraft, kraft can also help you configure, build and run you application.
<code>kraft up</code> can be broken down into the following commands:</p><pre><code>$ kraft configure
$ kraft build
$ kraft run
</code></pre><h2 id=required-tools-and-resources>Required Tools and Resources</h2><p>For this session, the following tools are needed: <code>qemu-kvm</code>, <code>qemu-system-x86_64</code>, <code>qemu-system-aarch64</code>, <code>gcc-aarch64-linux-gnu</code>.
To install on Debian/Ubuntu use the following command</p><pre><code>$ sudo apt-get -y install qemu-kvm qemu-system-x86 qemu-system-arm gcc-aarch64-linux-gnu
</code></pre><h3 id=support-files>Support Files</h3><p>Session support files are available <a href=https://github.com/unikraft/summer-of-code-2021>in the repository</a>.
If you already cloned the repository, update it and enter the session directory:</p><pre><code>$ cd path/to/repository/clone

$ git pull --rebase

$ cd content/en/docs/sessions/02-behind-scenes/

$ ls
demo/  images/  index.md  sol/
</code></pre><p>If you haven&rsquo;t cloned the repository yet, clone it and enter the session directory:</p><pre><code>$ git clone https://github.com/unikraft/summer-of-code-2021

$ cd summer-of-code-2021/content/en/docs/sessions/02-behind-scenes/

$ ls
demo/  images/  index.md  sol/
</code></pre><h2 id=overview>Overview</h2><h3 id=01-virtualization>01. Virtualization</h3><p>Through virtualization, multiple operating systems (OS) are able to run on the same hardware, independently, thinking that each one of them controls the entire system.
This can be done using a hypervisor, which is a low-level software that virtualizes the underlying hardware and manages access to the real hardware, either directly or through the host Operating System.
There are 2 main virtualized environments: virtual machines and containers, each with pros and cons regarding complexity, size, performance and security.
Unikernels come somewhere between those 2.</p><h4 id=virtual-machines>Virtual Machines</h4><p>Virtual machines represent an abstraction of the hardware, over which an operating system can run, thinking that it is alone on the system and that it controls the hardware below it.
Virtual machines rely on hypervisors to run properly.
Those hypervisors can be classified in 2 categories: Type 1 and Type 2.
We won&rsquo;t go in depth into them, but it is good to know how they are different:</p><ul><li>The <strong>Type 1 hypervisor</strong>, also known as <strong>bare-metal hypervisor</strong>, has direct access to the hardware and controls all the operating systems that are running on the system.
KVM, despite the appearances, is a Type 1 hypervisor.</li><li>The <strong>Type 2 hypervisor</strong>, also known as <strong>hosted hypervisor</strong>, has to go through the host operating system to reach the hardware.
An example of Type 2 hypervisor is VirtualBox.</li></ul><table><thead><tr><th style=text-align:center><img src=/docs/sessions/02-behind-scenes/images/vm1.svg alt="type 1 hypervisor os"></th><th style=text-align:center><img src=/docs/sessions/02-behind-scenes/images/vm2.svg alt="type 2 hypervisor os"></th></tr></thead><tbody><tr><td style=text-align:center>Operating systems over type 1 hypervisor</td><td style=text-align:center>Operating systems over type 2 hypervisor</td></tr></tbody></table><h4 id=containers>Containers</h4><p>Containers are environments designed to contain and run only one application and its dependencies.
This leads to very small sizes.
The containers are managed by a Container Management Engine, like Docker, and are dependent on the host OS, as they cannot run without it.</p><table><thead><tr><th style=text-align:center><img src=/docs/sessions/02-behind-scenes/images/container.svg alt=containers></th></tr></thead><tbody><tr><td style=text-align:center>Containers</td></tr></tbody></table><h4 id=unikraft>Unikraft</h4><p>Unikraft has a size comparable with that of a container, while it retains the power of a virtual machine, meaning it can directly control the hardware components (virtualized, or not, if running bare-metal).
This gives it an advantage over classical Operating Systems.
Being a special type of operating system, Unikraft can run bare-metal or over a hypervisor.</p><table><thead><tr><th style=text-align:center><img src=/docs/sessions/02-behind-scenes/images/unikraft1.svg alt="type 1 hypervisor uk"></th><th style=text-align:center><img src=/docs/sessions/02-behind-scenes/images/unikraft2.svg alt="type 2 hypervisor uk"></th></tr></thead><tbody><tr><td style=text-align:center>Unikraft over Type 1 hypervisor</td><td style=text-align:center>Unikraft over Type 2 hypervisor</td></tr></tbody></table><p>The following table makes a comparison between regular Virtual Machines (think of an Ubuntu VM), Containers and Unikernels, represented by Unikraft:</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>Virtual Machines</th><th style=text-align:center>Containers</th><th style=text-align:center>Unikernels</th></tr></thead><tbody><tr><td style=text-align:center><strong>Time performance</strong></td><td style=text-align:center>Slowest of the 3</td><td style=text-align:center>Fast</td><td style=text-align:center>Fast</td></tr><tr><td style=text-align:center><strong>Memory footprint</strong></td><td style=text-align:center>Heavy</td><td style=text-align:center>Depends on the number of features</td><td style=text-align:center>Light</td></tr><tr><td style=text-align:center><strong>Security</strong></td><td style=text-align:center>Very secure</td><td style=text-align:center>Least secure of the 3</td><td style=text-align:center>Very secure</td></tr><tr><td style=text-align:center><strong>Features</strong></td><td style=text-align:center>Everything you would think of</td><td style=text-align:center>Depends on the needs</td><td style=text-align:center>Only the absolute necessary</td></tr></tbody></table><h3 id=02-linuxu-and-kvm>02. linuxu and KVM</h3><p>Unikraft can be run in 2 ways:</p><ul><li>As a virtual machine, using QEMU/KVM or Xen.
It acts as an operating system, having the responsibility to configure the hardware components that it needs (clocks, additional processors, etc).
This mode gives Unikraft direct and total control over hardware components, allowing advanced functionalities.</li><li>As a <code>linuxu</code> build, in which it behaves as a Linux user-space application.
This severely limits its performance, as everything Unikraft does must go through the Linux kernel, via system calls.
This mode should be used only for development and debugging.</li></ul><p>When Unikraft is running using QEMU/KVM, it can either be run on an emulated system or a (para)virtualized one.
Technically, KVM means virtualization support is enabled.
If using QEMU in emulated mode, KVM is not used.
To keep things simple, we will use interchangeably the terms QEMU, KVM or QEMU/KVM to refer to this use (either virtualized, or emulated).</p><p>Emulation is slower, but it allows using CPU architectures different from the local one (you can run ARM code on a x86 machine).
Using (para)virtualisation, aka hardware acceleration, greater speed is achieved and more hardware components are visible to Unikraft.</p><h3 id=03-unikraft-core>03. Unikraft Core</h3><p>The Unikraft core is comprised of several components:</p><ul><li><a href=https://github.com/unikraft/unikraft/tree/staging/arch>the architecture code</a>:
This defines behaviours and hardware interactions specific to the target architecture (x86_64, ARM, RISC-V).
For example, for the x86_64 architecture, this component defines the usable registers, data types sizes and how Thread-Local Storage should happen.</li><li><a href=https://github.com/unikraft/unikraft/tree/staging/plat>the platform code</a>:
This defines interaction with the underlying hardware, depending on whether a hypervisor is present or not, and which hypervisor is present.
For example, if the KVM hypervisor is present, Unikraft will behave almost as if it runs bare-metal, needing to initialize the hardware components according to the manufacturer specifications.
The difference from bare-metal is made only at the entry, where some information, like the memory layout, the available console, are supplied by the bootloader (Multiboot) and there&rsquo;s no need to interact with the BIOS or UEFI.
In the case of Xen, many of the hardware-related operations must be done through hypercalls, thus reducing the direct interaction of Unikraft with the hardware.</li><li><a href=https://github.com/unikraft/unikraft/tree/staging/lib>internal libraries</a>:
These define behaviour independent of the hardware, like scheduling, networking, memory allocation, basic file systems.
These libraries are the same for every platform or architecture, and rely on the platform code and the architecture code to perform the needed actions.
The internal libraries differ from the external ones in the implemented functionalities.
The internal ones define parts of the kernel, while the external ones define user-space level functionalities.
For example, <strong>uknetdev</strong> and <strong>lwip</strong> are 2 libraries that define networking components.
<a href=https://github.com/unikraft/unikraft/tree/staging/lib/uknetdev>Uknetdev</a> is an internal library that interacts with the network card and defines how packages are sent using it.
<a href=https://github.com/unikraft/lib-lwip>Lwip</a> is an external library that defines networking protocols, like IP, TCP, UDP.
This library knows that the packages are somehow sent over the NIC, but it is not concerned how.
That is the job of the kernel.</li></ul><h3 id=04-libc-in-unikraft>04. libc in Unikraft</h3><p>The Unikraft core provides only the bare minimum components to interact with the hardware and manage resources.
A software layer, similar to the standard C library in a general-purpose OS, is required to make it easy to run applications on top of Unikraft.</p><p>Unikraft has multiple variants of a libc-like component:</p><ul><li><a href=https://github.com/unikraft/unikraft/tree/staging/lib/nolibc>nolibc</a> is a minimalistic libc, part of the core Unikraft code, that contains only the functionality needed for the core (strings, qsort, etc).</li><li><a href=https://github.com/unikraft/unikraft/tree/staging/lib/isrlib>isrlib</a> is the interrupt-context safe variant of nolibc.
It is used for interrupt handling code.</li><li><a href=https://github.com/unikraft/lib-newlib>newlibc</a> is the most complete libc currently available for Unikraft, but it still lacks some functionalities, like multithreading.
Newlibc was designed for embedded environments.</li><li><a href=https://github.com/unikraft/lib-musl>musl</a> is, theoretically, the best libc that will be used by Unikraft, but it&rsquo;s currently in testing.</li></ul><p>Nolibc and isrlib are part of the Unikraft core.
Newlibc and musl are external libraries, from the point of view of Unikraft, and they must be included to the build, as shown in <a href=/docs/sessions/01-baby-steps>Session 01: Baby Steps</a>.</p><h3 id=05-configuring-unikraft---configuk>05. Configuring Unikraft - Config.uk</h3><p>Unikraft is a configurable operating system, where each component can be modified, configured, according to the user’s needs.
This configuration is done using a version of Kconfig, through the <strong>Config.uk</strong> files.
In these files, options are added to enable libraries, applications and different components of the Unikraft core.
The user can then apply those configuration options, using <code>make menuconfig</code>, which generates an internal configuration file that can be understood by the build system, <strong>.config</strong>.
Once configured, the Unikraft image can be built, using <code>make</code>, and run, using the appropriate method (Linux ELF loader, qemu-kvm, xen, others).</p><p>Configuration can be done in 3 ways:</p><ul><li><p>Manually, using</p><pre><code>$ make menuconfig
</code></pre></li><li><p>Adding a dependency in <strong>Config.uk</strong> for a component, so that the dependency gets automatically selected when the component is enabled.
This is done using <code>depends on</code> and <code>select</code> keywords in <strong>Config.uk</strong>.
The configuration gets loaded and the <strong>.config</strong> file is generated by running</p><pre><code>$ make menuconfig
</code></pre><p>This type of configuration removes some configuration steps, but not all of them.</p></li><li><p>Writing the desired configuration in <strong>kraft.yaml</strong>.
The configuration gets loaded and the <strong>.config</strong> file is generated by running</p><pre><code>$ kraft configure
</code></pre></li></ul><p>In this session, we will use the first and the last configuration options.</p><h3 id=06-the-build-system---basics>06. The Build System - basics</h3><p>Once the application is configured, in <strong>.config</strong>, symbols are defined (eg. <code>CONFIG_ARCH_X86_64</code>).
Those symbols are usable both in the C code, to include certain functionalities only if they were selected in the configuring process, and in the actual building process, to include / exclude source files, or whole libraries.
This last thing is done in <strong>Makefile.uk</strong>, where source code files are added to libraries.
During the build process, all the <code>Makefile.uk</code> files (from the Unikraft core and external libraries) are evaluated, and the selected files are compiled and linked, to form the Unikraft image.</p><table><thead><tr><th style=text-align:center><img src=/docs/sessions/02-behind-scenes/images/build_uk.svg alt="unikraft build"></th></tr></thead><tbody><tr><td style=text-align:center>The build process of Unikraft</td></tr></tbody></table><h2 id=summary>Summary</h2><ul><li>Unikraft is a special type of operating system, that can be configured to match the needs of a specific application.</li><li>This configuration is made possible by a system based on Kconfig, that uses <strong>Config.uk</strong> files to add possible configurations, and <strong>.config</strong> files to store the specific configuration for a build.</li><li>The configuration step creates symbols that are visible in both Makefiles and source code.</li><li>Each component has its own <strong>Makefile.uk</strong>, where source files can be added, removed, or be made dependent on the configuration.</li><li>Unikraft has an internal libc, but it can use others, more complex and complete, like newlib and musl.</li><li>Being an operating system, it needs to be run by a hypervisor, like KVM, xen, to work at full capacity.
It can also be run as an ELF, in Linux, but in this way the true power of Unikraft is not achieved.</li></ul><h2 id=work-items>Work Items</h2><h3 id=support-files-1>Support Files</h3><p>Session support files are available <a href=https://github.com/unikraft/summer-of-code-2021>in the repository</a>.
If you already cloned the repository, update it and enter the session directory:</p><pre><code>$ cd path/to/repository/clone

$ git pull --rebase

$ cd content/en/docs/sessions/02-behind-scenes/

$ ls
demo/  images/  index.md  sol/
</code></pre><p>If you haven&rsquo;t cloned the repository yet, clone it and enter the session directory:</p><pre><code>$ git clone https://github.com/unikraft/summer-of-code-2021

$ cd summer-of-code-2021/content/en/docs/sessions/02-behind-scenes/

$ ls
demo/  images/  index.md  sol/
</code></pre><h3 id=01-tutorial--reminder-building-and-running-unikraft>01. Tutorial / Reminder: Building and Running Unikraft</h3><p>We want to build the Helloworld application, using the Kconfig-based system, for the <strong>linuxu</strong> and <strong>KVM</strong> platforms, for the <strong>ARM</strong> and <strong>x86</strong> architectures, and then run them.</p><p>If you don&rsquo;t have the unikraft and app-helloworld repositories cloned already, do so, by running the following commands:</p><pre><code>$ git clone https://github.com/unikraft/unikraft
$ cd apps
$ git clone https://github.com/unikraft/app-helloworld helloworld/
</code></pre><p>As you can see from the commands above, it is recommended to have the following file structure in your working directory:</p><pre><code>workdir
|_______apps
|	|_______helloworld
|_______libs
|_______unikraft
</code></pre><p>Make sure that <code>UK_ROOT</code> and <code>UK_LIBS</code> are set correctly in the <code>Makefile</code> file, in the <code>helloworld</code> folder.
If you are not sure if they are set correctly, set them like this:</p><pre><code>UK_ROOT ?= $(PWD)/../../unikraft
UK_LIBS ?= $(PWD)/../../libs
</code></pre><h4 id=linuxu-x86_64>Linuxu, x86_64</h4><p>First, we will the image for the <strong>linuxu</strong> platform.
As the resulting image will be an ELF, we can only run the <strong>x86</strong> Unikraft image.
We follow the steps:</p><ol><li><p>While in the <code>helloworld</code> folder, run</p><pre><code>$ make menuconfig
</code></pre></li><li><p>From <code>Architecture Selection</code>, select <code>Architecture</code> -> <code>x86 compatible</code>.</p></li><li><p>From <code>Platform Configuration</code>, select <code>Linux user space</code>.</p></li><li><p>Save, exit and run</p><pre><code>$ make
</code></pre></li><li><p>The resulting image, <code>app-helloworld_linuxu-x86_64</code> will be present in the <code>build/</code> folder.
Run it.</p><pre><code>$ ./build/app-helloworld_linuxu-x86_64
</code></pre></li></ol><h4 id=kvm-x86_64>KVM, x86_64</h4><p>Next, we will build the image for the <strong>kvm</strong> platform.
Before starting the process, make sure that you have the necessary tools, listed in the <a href=/docs/sessions/02-behind-scenes/#required-tools>Required Tools</a> section.
We follow the steps:</p><ol><li><p>Run</p><pre><code>$ make menuconfig
</code></pre></li><li><p>We will leave the architecture as is, for now.</p></li><li><p>From <code>Platform Configuration</code>, select <code>KVM guest</code>.</p></li><li><p>Save, exit and run</p><pre><code>$ make
</code></pre></li><li><p>Load the resulting image in QEMU by using</p><pre><code>$ sudo qemu-system-x86_64 -kernel ./build/app-helloworld_kvm-x86_64 -serial stdio
</code></pre></li></ol><p>Besides <code>-serial stdio</code>, no other option is needed to run the Helloworld application.
Other, more complex applications, will require more options given to qemu.</p><p>We have run Unikraft in the emulation mode, with the command from above.
We can also run it in the virtualization mode, by adding the <code>-enable-kvm</code> option.
You may receive a warning, <code>host doesn't support requested feature:</code>.
This is because kvm uses a generic cpu model.
You can instruct kvm to use your local cpu model, by adding <code>-cpu host</code> to the command.</p><p>The final command will look like this:</p><pre><code>$ sudo qemu-system-x86_64 -enable-kvm -cpu host -kernel ./build/app-helloworld_kvm-x86_64 -serial stdio
</code></pre><p>While we are here, we can check some differences between emulation and virtualization.
Record the time needed by each image to run, using <code>time</code>, like this:</p><pre><code>$ time sudo qemu-system-x86_64 -kernel ./build/app-helloworld_kvm-x86_64 -serial stdio
$ time sudo qemu-system-x86_64 -enable-kvm -cpu host -kernel ./build/app-helloworld_kvm-x86_64 -serial stdio
</code></pre><p>Because <code>helloworld</code> is a simple application, the <strong>real</strong> running time will be similar.
The differences are where each image runs most of its time: in user space, or in kernel space.
Find an explaination to those differences.</p><h4 id=kvm-arm>KVM, ARM</h4><p>To configure Unikraft for the ARM architecture, go to the configuration menu, like before, and select, from <code>Architecture Selection</code>, <code>Armv8 compatible</code>.
Save and exit the configuration.
As a new architecture is selected, you have to clean the previously compiled files:</p><pre><code>$ make clean
</code></pre><p>After cleaning, build the image:</p><pre><code>$ make
</code></pre><p>To run Unikraft, use the following command:</p><pre><code>$ sudo qemu-system-aarch64 -machine virt -cpu cortex-a57 -kernel ./build/app-helloworld_kvm-arm64 -serial stdio
</code></pre><p>Note that now we need to provide a machine and a cpu model to be emulated, as there are no defaults available.
If you want to find information about other machines, run</p><pre><code>$ sudo qemu-system-aarch64 -machine help
</code></pre><h3 id=02-tutorial-make-it-speak>02. Tutorial: Make It Speak</h3><p>The goal of this exercise is to enable the internal debugging library for Unikraft (<code>ukdebug</code>) and make it display messages up to the <em>info</em> level.
We also want to identify which hardware components are initialized for both x86 and ARM, and where.</p><h4 id=arm>ARM</h4><p>Considering that the last exercise ended with an ARM image, we will start now with that configuration.
We need to enable <code>ukdebug</code> in the configuration menu.
It is located in the <code>Library Configuration</code> menu.
But, for this exercise, besides enabling a component, we must modify it.</p><p>Enter the <code>ukdebug</code> configuration menu.
We need to have <code>Enable kernel messages (uk_printk)</code> checked.
Also, we need to change the option below it, <code>Kernel message level</code>, from <code>Show critical and error messages (default)</code> to <code>Show all types of messages</code>.
To make thing prettier, also enable the <code>Colored output</code> option.
Save and exit the configuration, then build and run the image.</p><p>We have a bunch of initializations happening, before seeing the &ldquo;Hello world!&rdquo; message.
Let&rsquo;s break them down. We start with the platform internal library, <code>libkvmplat</code>.
Here, the hardware components are initialized, like the Serial module, <code>PL001 UART</code>, and the <code>GIC</code>, which is the interrupt controller.
After that, the memory address space is defined, and the booting process starts, by replacing the current stack with a larger one, that is part of the defined address space.
Lastly, before calling the main function of the application, the software components of Unikraft are initialized, like timers, interrupts, and bus handlers.
The execution ends in in the platform library, with the shutdown command.</p><h4 id=x86_64>x86_64</h4><p>For the x86 part, just change the architecture in the configuration interface.
Recall that, after changing the architecture, we have to clean the previously compiled files:</p><pre><code>$ make clean
</code></pre><p>Build Unikraft:</p><pre><code>$ make
</code></pre><p>And run in under QEMU/KVM.
The output differs.
We can see that, in the case of x86, the platform library initializes less components, or it is less verbose than the ARM one.
But the timer and bus initialization is more verbose.
We see what timer is used, the i8254 one.
Also, we see that the PCI bus is used.</p><p>If you are wondering what the Constructors are, they will be covered in <a href=/docs/sessions/06-testing-unikraft/>Session 06: Testing Unikraft</a></p><h3 id=03-more-messages>03. More Messages</h3><p>Sometimes we need a more detailed output.
For this, <code>ukdebug</code> has the option to show <em>debug</em> level messages.
Enable them and run Unikraft, for either ARM or x86 architectures, or both.</p><h3 id=04-going-through-the-code>04. Going through the Code</h3><p>Having the output of <code>ukdebug</code>, go through the Unikraft code, in the <code>unikraft</code> folder.
Find the components that you have seen in the outputs, in the platform library, and where the kernel messages are sent.
The platform library, even though is called a library, is not in the <code>lib</code> subfolder.
It is placed in the <code>plat</code> folder.
Explore the code, at your own pace.
Can you also find where the main function is called?</p><h3 id=05-i-have-an-important-message>05. I Have an Important Message</h3><p>Send an important kernel message, that everyone needs to see, right before the main function is called.
Try different message levels (critical, error, warning, info, debug), to see how they differ.</p><p>Note: sending a critical kernel message will not affect how Unikraft runs after the message.</p><h3 id=06-tutorial--reminder-adding-filesystems-to-an-application>06. Tutorial / Reminder: Adding Filesystems to an Application</h3><p>For this tutorial, the aim is to modify the helloworld app, to use the 9pfs filesystem: read something from a file, and display it.
Use kraft, the <code>qemu-guest</code> script, and <code>qemu-system</code> to run the modified application.</p><p>Some parts of this tutorial were already discussed last session.</p><h4 id=the-code>The Code</h4><p>First of all, we need to write some simple code, to read from a file. We will do this in <code>main.c</code>.</p><pre><code>	FILE *in = fopen(&quot;file&quot;, &quot;r&quot;);
	char buffer[100];

	fread(buffer, 1, 100, in);
	printf(&quot;File contents: %s\n&quot;, buffer);
	fclose(in);
</code></pre><p>In the application&rsquo;s folder, we will create a folder, <code>guest_fs</code> (or any other name).
In this folder, we will add our file.</p><h4 id=configuring-the-application>Configuring the Application</h4><p>First, we need to add a more powerfull libc. Newlib will do nicely. For this, in the <code>Makefile</code> file, we add the following line:</p><pre><code>LIBS := $(UK_LIBS)/newlib
</code></pre><p><strong>Note</strong>: the build will fail if <code>unikraft</code> and <code>newlib</code> repositories aren&rsquo;t both on the <code>staging</code> or the <code>stable</code> branches.
For this session, use the <code>staging</code> branch, for every repository used.</p><p>Now we need to enable <strong>9pfs</strong> and <strong>newlib</strong> in Unikraft.
To do this, we run</p><pre><code>$ make menuconfig
</code></pre><p>We need to select the following options, from the <code>Library Configuration</code> menu:</p><ul><li><code>libnewlib</code></li><li><code>vfscore</code></li><li><code>vfscore: Configuration</code> -> <code>Automatically mount a root filesystem</code> -> <code>Default root filesystem</code> -> <code>9pfs</code></li></ul><p>These configurations will also mark as required <strong>9pfs</strong> and <strong>uk9p</strong> in the menu.</p><p>We want to run Unikraft with QEMU/KVM, so we must selevct <strong>KVM guest</strong> in the <code>Platform Configuration</code> menu.
We also need to enable, in the KVM guest options menu, <code>Virtio</code> -> <code>Virtio PCI device support</code>.</p><p>Save, exit, and build the Unikraft image:</p><pre><code>make
</code></pre><p>Building the Unikraft image will take a while.</p><h4 id=running-with-qemu-system-x86_64>Running with qemu-system-x86_64</h4><p>To run the Unikraft image with QEMU/KVM, we use the following command:</p><pre><code>$ qemu-system-x86_64 -fsdev local,id=myid,path=guest_fs,security_model=none -device virtio-9p-pci,fsdev=myid,mount_tag=rootfs -kernel build/app-helloworld_kvm-x86_64 -serial stdio
</code></pre><p>Lets break it down:</p><ul><li><code>-serial stdio</code> - prints the output of QEMU to the standard output</li><li><code>-kernel build/app-helloworld_kvm-x86_64</code> - tells QEMU that it will run a kernel;
if this parameter is omited, QEMU will think it runs a raw file</li><li><code>-fsdev local,id=myid,path=guest_fs,security_model=none</code> - assign an id to the <code>guest_fs</code> local folder</li><li><code>-device virtio-9p-pci,fsdev=myid,mount_tag=rootfs</code> - create a device with the 9pfs type, link to it the ID from above, and assign it a mount tag.
Unikraft will look after that mount tag when trying to mount the filesystem, so it is important that the mount tag from the configuration is the same as the one given as argument to qemu.</li></ul><h4 id=runing-with-qemu-guest>Runing with qemu-guest</h4><p><a href=https://github.com/unikraft/kraft/blob/staging/scripts/qemu-guest>qemu-guest</a> is the script used by kraft to run its QEMU/KVM images.
Before looking at the command, take some time to look through the script, and maybe figure out the arguments needed for our task.</p><p>To run Unikraft using qemu-guest, we use:</p><pre><code>$ ./qemu-guest -e guest_fs/ -k build/app-helloworld_kvm-x86_64
</code></pre><p>If we add the <code>-D</code> option, we can see the qemu-system command generated.</p><p>You may get the following error:</p><pre><code>[    0.100664] CRIT: [libvfscore] &lt;rootfs.c @  122&gt; Failed to mount /: 22
</code></pre><p>If you do, check that the mount tag in the configuration is the same as the one used by <code>qemu-guest</code>.
<code>qemu-guest</code> will use the tag <strong>fs0</strong>.</p><h4 id=enter-kraft>Enter kraft</h4><p>With kraft, the whole process of configuring, building and running Unikraft can be made easier.
First, we need to modify <strong>kraft.yaml</strong>, to reflect our new configuration, like this:</p><pre><code>specification: '0.5'
name: helloworld
unikraft:
  version: staging
  kconfig:
    - CONFIG_LIBUK9P=y
    - CONFIG_LIB9PFS=y
    - CONFIG_LIBVFSCORE_AUTOMOUNT_ROOTFS=y
    - CONFIG_LIBVFSCORE_ROOTFS_9PFS=y
    - CONFIG_LIBVFSCORE_ROOTDEV=&quot;fs0&quot;
targets:
  - architecture: x86_64
    platform: kvm
libraries:
  newlib:
    version: staging
    kconfig:
      - CONFIG_LIBNEWLIBC=y
volumes:
  fs0:
    driver: 9pfs
    source: guest_fs.tgz
</code></pre><p>Next, we will make kraft reconfigure our application, using <code>kraft configure -y</code>.
In our case, nothing will be modified in <strong>.config</strong>, as we had the same configuration before.
If you get an error like &ldquo;missing component: newlib&rdquo;, you need to run <code>kraft list update</code>.</p><p>Then, build:</p><pre><code>$ kraft build
</code></pre><p>And run:</p><pre><code>$ ./qemu-guest -e guest_fs/ -k build/app-helloworld_kvm-x86_64
</code></pre><h3 id=07-tutorial-give-the-user-a-choice>07. Tutorial: Give the User a Choice</h3><p>The goal of this exercise is to modify <strong>Config.uk</strong>, for the helloworld app, so that the user can choose if the app will display <em>Hello world</em>, or what it reads from the file from the previous exercise.</p><p>First of all, we need to add a new configuration in Config.uk.
We will do it like this:</p><pre><code>config APPHELLOWORLD_READFILE
	bool &quot;Read my file&quot;
	default n
	help
	  Reads the file in guest_fs/ and prints its contents,
	  instead of printing helloworld
</code></pre><p>After this, we need to modify our code in <code>main.c</code>, to use this configuration option.</p><pre><code>#ifndef CONFIG_APPHELLOWORLD_READFILE
	printf(&quot;Hello world!\n&quot;);
#else
	FILE *in = fopen(&quot;file&quot;, &quot;r&quot;);
	char buffer[100];

	fread(buffer, 1, 100, in);
	printf(&quot;File contents: %s\n&quot;, buffer);
	fclose(in);
#endif
</code></pre><p>Note that, for our configuration option <code>APPHELLOWORLD_READFILE</code>, a symbol, <code>CONFIG_APPHELLOWORLD_READFILE</code>, was defined.
We tell GCC that, if that symbol was not defined, it should use the <code>printf("Hello world!\n")</code>.
Otherwise, it should use the code written by us.</p><p>The last step is to configure the application.
We do this by running <code>make menuconfig</code>, then going to the <code>Application Options</code> and enabling our configuration option.</p><p>Now we can build and run the new Unikraft image.</p><h3 id=08-tutorial-arguments-from-command-line>08. Tutorial: Arguments from Command Line</h3><p>We want to configure the helloworld app to receive command line arguments and then print them.</p><p>For this, the Helloworld application already has a configuration option.
Configure the application by running</p><pre><code>$ make menuconfig
</code></pre><p>In the configuration menu, go to <code>Application Options</code> and enable <code>Print arguments</code>.
If we build and run the image now, using <code>qemu-guest</code>, we will see that two arguments are passed to Unikraft: the kernel argument, and a console.
We want to pass it an aditional argument, <code>"foo=bar"</code>.</p><p>Before this, make sure to reset your configuration, so Unikraft won&rsquo;t use 9pfs for this task:</p><pre><code>$ make clean
</code></pre><h4 id=raw-qemu-command>Raw qemu command</h4><p>To send an argument with qemu-system, we use the <code>-append</code> option, like this:</p><pre><code>$ qemu-system-x86_64 -kernel build/app-helloworld_kvm-x86_64 -append &quot;console=ttyS0 foo=bar&quot; -serial stdio
</code></pre><h4 id=qemu-guest-script>qemu-guest script</h4><p>To send an argument with the qemu-guest script, we use the <code>-a</code> option, like this:</p><pre><code>$ ./qemu-guest -k build/app-helloworld_kvm-x86_64 -a &quot;foo=bar&quot;
</code></pre><h4 id=kraft-1>Kraft</h4><p>To send an argument while using kraft, run it like this:</p><pre><code>$ kraft run &quot;foo=bar&quot;
</code></pre><h3 id=09-adding-a-new-source-file>09. Adding a new source file</h3><p>Create a new source file for your application, and implement a function that sorts a given integer array, by calling qsort, in turn, from different libc variants, and then prints that array.
For each library, check the size of the Unikraft image.
Enable <strong>nolibc</strong> and then, as a separate config / build, <strong>newlibc</strong>, both by using <strong>make menuconfig</strong> and modifying <strong>kraft.yaml</strong>.
You will have four different configurations and builds:</p><ul><li>nolibc + kraft</li><li>nolibc + make</li><li>newlibc + kraft</li><li>newlibc + make</li></ul><h3 id=10-more-power-to-the-user>10. More Power to the User</h3><p>Add the possibility to include the new source file only if a configuration option is selected.
Make sure that after this change, the application can still be built and run.</p><h3 id=11-less-power-to-the-user>11. Less Power to the User</h3><p>Delete <code>Config.uk</code> and reconfigure / rebuild the app.
What happens when you run the app?</p><h3 id=12-give-us-feedback>12. Give Us Feedback</h3><p>We want to know how to make the next sessions better.
Fo this we need your <a href=https://forms.gle/awraHJpjLaPDeXzk9>feedback</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7cf16a4b6aedab923e52e136ddacfa59>5 - Session 03: Benchmarking and Debugging</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-cbba34b6d1e7d9a0e83c791f84d7f29d>6 - Session 04: Complex Applications</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-221c0eb25b4f393f30fd7c711495bed2>7 - Session 05: Contributing to Unikraft</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-c8164d0e219bb0f24fd8b32fe7e996e3>8 - Session 06: Testing Unikraft</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-e8257ea2e30401a82888d38de2231d40>9 - Session 07: Syscall Shim</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-0cf305157c0d79c36b53cb269a783170>10 - Session 08: Basic App Porting</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-f352576afa36c9b30f15b2be6533c580>11 - Session 09: Advanced App Porting</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-9026b735a1faa018402aa9ac7ce1ebd9>12 - Session 10: High Performance</h1></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel="noopener noreferrer" href=https://bit.ly/UnikraftDiscord><i class="fab fa-discord"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/UnikraftSDK><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/unikraft/unikraft><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://linkedin.com/company/unikraft-sdk><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Unikraft and Open-Source Contributors. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>